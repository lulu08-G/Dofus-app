## TELECHARGER LES FICHERS DE L ARTEFACT DODUDA 

   st.title("Page DESIGNE")

    def download_and_extract_artifact():
        # Lien vers l'artefact GitHub
        artifact_url = "https://api.github.com/repos/lulu08-G/Dofus-app/actions/artifacts/2814294485/zip"
        GITHUB_TOKEN = st.secrets["GITHUB_TOKEN"] if "GITHUB_TOKEN" in st.secrets else None
        
        if not GITHUB_TOKEN:
            st.error("âŒ Erreur : Token GitHub manquant.")
            return
        
        headers = {
            "Authorization": f"Bearer {GITHUB_TOKEN}",
            "Accept": "application/vnd.github+json"
        }
    
        zip_path = "artifact.zip"
        max_file_size = 3000 * 1024 * 1024  # 1000 MB (3 Go)
    
        # ğŸ¯ VÃ©rification de la taille du fichier avant le tÃ©lÃ©chargement
        st.write("ğŸ”„ VÃ©rification de la taille du fichier...")
    
        try:
            # RÃ©cupÃ©rer la taille du fichier via l'API GitHub
            response = requests.head(artifact_url, headers=headers, allow_redirects=True)
            if response.status_code == 200:
                file_size = int(response.headers.get('Content-Length', 0))
                st.write(f"ğŸ“ Taille du fichier : {file_size / (1024 * 1024):.2f} MB")
                
                if file_size > max_file_size:
                    st.error(f"âŒ Le fichier est trop gros ({file_size / (1024 * 1024):.2f} MB). Taille maximale autorisÃ©e : {max_file_size / (1024 * 1024):.2f} MB.")
                    return
            else:
                st.error(f"âŒ Erreur lors de la rÃ©cupÃ©ration des informations sur le fichier : {response.status_code}")
                return
        except Exception as e:
            st.error(f"âŒ Erreur lors de la vÃ©rification de la taille : {e}")
            return
    
        # ğŸ¯ DÃ©marrer le tÃ©lÃ©chargement
        st.write("ğŸ”„ TÃ©lÃ©chargement du fichier...")
    
        try:
            with requests.get(artifact_url, headers=headers, stream=True, timeout=300) as response:
                if response.status_code == 200:
                    with open(zip_path, "wb") as file:
                        for chunk in response.iter_content(chunk_size=8192):
                            file.write(chunk)
                    st.success(f"âœ… Fichier tÃ©lÃ©chargÃ© : {zip_path}")
                    
                    # ğŸ¯ DÃ©compresser l'archive
                    st.write("âœ… DÃ©compression du fichier ZIP...")
    
                    with zipfile.ZipFile(zip_path, 'r') as zip_ref:
                        zip_ref.extractall("resultats")  # Extraire dans le dossier 'resultats'
                    st.write("âœ… Artefact extrait avec succÃ¨s.")
                    
                    # Lister les fichiers extraits
                    files = os.listdir("resultats")
                    st.write("ğŸ“‚ Contenu du dossier 'resultats' :", files)
                else:
                    st.error(f"âŒ Erreur lors du tÃ©lÃ©chargement : {response.status_code}")
                    st.write(response.text)  # Afficher la rÃ©ponse de GitHub pour le dÃ©bogage
        except requests.exceptions.Timeout:
            st.error("âŒ Timeout pendant le tÃ©lÃ©chargement. L'opÃ©ration a pris trop de temps.")
        except Exception as e:
            st.error(f"âŒ Erreur pendant le tÃ©lÃ©chargement ou la dÃ©compression : {e}")

    download_and_extract_artifact()
